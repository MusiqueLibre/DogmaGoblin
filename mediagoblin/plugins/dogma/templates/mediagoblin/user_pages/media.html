{#
# GNU MediaGoblin -- federated, autonomous media hosting
# Copyright (C) 2011, 2012 MediaGoblin contributors.  See AUTHORS.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#}

{#  21 03 2014 : ardoisebleue
Ce fichier a été modifié en attente de la traduction automatique
Les lignes en anglais sont commentées par : 

# msg trad
ou // msg trad
ou /* msg trad
   */
ou <!-- msg trad -->

-#}

{%- extends "mediagoblin/base.html" %}

{% import "/mediagoblin/utils/wtforms.html" as wtforms_util %}
{% from "mediagoblin/utils/pagination.html" import render_pagination %}

{% block title %}{{ media.title }} &mdash; {{ super() }}{% endblock %}

{% block mediagoblin_head %}

  {% template_hook("media_head") %}
{% endblock mediagoblin_head %}

{% block mediagoblin_content %}
  <div id="main_content_title">
  
<!-- msg trad 
    <a id="home_link_link" href="{{ request.urlgen('index') }}" title="{%trans%}Home{%endtrans%}">&#8962</a>
-->

    <a id="home_link_link" href="{{ request.urlgen('index') }}" title="Accueil">&#8962</a>
    <h1 id="main_content_title_inner">
        {{ media.title }}
    </h1>
  </div>
  {% include "mediagoblin/utils/prev_next.html" %}
  <section class="media_pane content default_bg">     
    <div class="media_image_container visual_block">
      {% block mediagoblin_media %}
        {% set display_media = request.app.public_store.file_url(
                 media.get_display_media()[1]) %}
        {# if there's a medium file size, that means the medium size
         #  isn't the original... so link to the original!
         #}
        {% if media.media_files.has_key('medium') %}
          <a href="{{ request.app.public_store.file_url(
                        media.media_files['original']) }}">
<!-- msg trad                  
            <img class="media_image"
                 src="{{ display_media }}"
                 alt="{% trans media_title=media.title -%}
                        Image for {{ media_title }}{% endtrans %}" />
-->
            <img class="media_image"
                 src="{{ display_media }}"
                 alt=" Image de {{ media.title }}" />
          </a>
        {% else %}
        
<!-- msg trad         
          <img class="media_image"
               src="{{ display_media }}"
               alt="{% trans media_title=media.title -%}
                      Image for {{ media_title }}{% endtrans %}" />
-->
          <img class="media_image"
               src="{{ display_media }}"
               alt=" Image de {{ media.title }}" />
        {% endif %}
      {% endblock %}
    </section>
    <section class="content default_bg">
    {% if request.user and
          (media.uploader == request.user.id or 
           request.user.has_privilege('admin','moderator')) %}
      {% set edit_url = request.urlgen('mediagoblin.edit.edit_media',
                                 user= media.get_uploader.username,
                                 media_id=media.id) %}
<!-- msg trad                                 
      <a class="button_action" href="{{ edit_url }}">{% trans %}Edit{% endtrans %}</a>
      {% set delete_url = request.urlgen('mediagoblin.user_pages.media_confirm_delete',
                                 user= media.get_uploader.username,
                                 media_id=media.id) %}
      <a class="button_action" href="{{ delete_url }}">{% trans %}Delete{% endtrans %}</a>
-->
      <a class="button_action" href="{{ edit_url }}">Editer</a>
      {% set delete_url = request.urlgen('mediagoblin.user_pages.media_confirm_delete',
                                 user= media.get_uploader.username,
                                 media_id=media.id) %}
      <a class="button_action" href="{{ delete_url }}">Supprimer</a>

    {% endif %}
    {% autoescape False %}
      <p>{{ media.description_html }}</p>
    {% endautoescape %}
    {% if comments %}
    {#
          <a
            {% if not request.user %}
              href="{{ request.urlgen('mediagoblin.auth.login') }}"
            {% endif %}
            class="button_action" id="button_addcomment" title="Add a comment">
            
<!-- msg trad            
            {% trans %}Add a comment{% endtrans %}
-->
            Ajouter un commentaire.
         </a>
      {% if request.user %}
        <form action="{{ request.urlgen('mediagoblin.user_pages.media_post_comment', 
                                         user= media.get_uploader.username,
                                         media_id=media.id) }}" method="POST" id="form_comment">
          {{ wtforms_util.render_divs(comment_form) }}
          <div class="form_submit_buttons">
          
<!-- msg trad          
            <input type="submit" value="{% trans %}Add this comment{% endtrans %}" class="button_action" />
-->
            <input type="submit" value="Ajouter ce commentaire" class="button_action" />

              {{ csrf_token }}
          </div>
        </form>
      {% endif %}
      <ul style="list-style:none">
      {% for comment in comments %}
        {% set comment_author = comment.get_author %}
        <li id="comment-{{ comment.id }}"
          {%- if pagination.active_id == comment.id %}
            class="comment_wrapper comment_active">
            <a name="comment" id="comment"></a>
          {%- else %}
            class="comment_wrapper">
          {%- endif %}
          <div class="comment_author">
            <img src="{{ request.staticdirect('/images/icon_comment.png') }}" />
            <a href="{{ request.urlgen('mediagoblin.user_pages.user_home',
                            user=comment_author.username) }}">
              {{- comment_author.username -}}
            </a>
<!-- msg trad            
            {% trans %}at{% endtrans %}
-->
            de 
            <a href="{{ request.urlgen('mediagoblin.user_pages.media_home.view_comment',
                            comment=comment.id,
                            user=media.get_uploader.username,
                            media=media.slug_or_id) }}#comment">
              {{- comment.created.strftime("%I:%M%p %Y-%m-%d") -}}
            </a>:
          </div>
          <div class="comment_content">
            {% autoescape False -%}
              {{ comment.content_html }}
            {%- endautoescape %}
          </div>
        </li>
      {% endfor %}
      </ul>
      {{ render_pagination(request, pagination,
                 media.url_for_self(request.urlgen)) }}
                 #}
    {% endif %}
  </div>
  <div class="media_sidebar">
<!-- msg trad
    {% trans date=media.created.strftime("%Y-%m-%d") -%}
      <h3>Added on</h3>
      <p>{{ date }}</p>
    {%- endtrans %}
-->
      <h3>Ajoute</h3>
		<p>{{ media.created.strftime("%Y-%m-%d") }}</p>
		    
    {% if media.tags %}
      {% include "mediagoblin/utils/tags.html" %}
    {% endif %}

    {% include "mediagoblin/utils/license.html" %}

    {% include "mediagoblin/utils/exif.html" %}
    
    {%- if media.attachment_files|count %}
    
<!-- msg trad
      <h3>{% trans %}Attachments{% endtrans %}</h3>
-->
      <h3>Annexes</h3>
      <ul>
        {%- for attachment in media.attachment_files %}
          <li>
            <a href="{{ request.app.public_store.file_url(attachment.filepath) }}">
              {{- attachment.name -}}
            </a>
          </li>
        {%- endfor %}
      </ul>
    {%- endif %}
    {%- if app_config['allow_attachments']
          and request.user
          and (media.uploader == request.user.id or
               request.user.has_privilege('admin','moderator')) %}
      {%- if not media.attachment_files|count %}
      
<!-- msg trad
      <h3>{% trans %}Attachments{% endtrans %}</h3>
-->
      <h3>Annexes</h3>
      {%- endif %}
      <p>
      
<!-- msg trad
        <a href="{{ request.urlgen('mediagoblin.edit.attachments',
                      user=media.get_uploader.username,
                      media_id=media.id) }}">
          {%- trans %}Add attachment{% endtrans -%}
        </a>
-->
        <a href="{{ request.urlgen('mediagoblin.edit.attachments',
                      user=media.get_uploader.username,
                      media_id=media.id) }}">
          Ajouter une annexe
        </a>
      </p>
    {%- endif %}

    {% template_hook("media_sideinfo") %}

    {% block mediagoblin_sidebar %}
    {% endblock %}

  </div>
</section>
{% endblock %}
